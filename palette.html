<html>
<head>
    <title>Noxel</title>

    <style>
	    button {
		    background-color: #444;
		    border: 1px solid #333;
		    color: white;
		    text-align: center;
		    text-decoration: none;
		    display: inline-block;
		    font-size: 12px;
		}
	</style>
</head>
<body bgcolor='#222'>
    <script>
    	var notes = [
		    55.000,
			58.270,
			61.735,
			65.406,
			69.296,
			73.416,
			77.782,
			82.407,
			87.307,
			92.499,
			97.999,
			103.826
		];

    	var div = document.createElement(div);
    	div.style = {};
    	div.style.position = "absolute";
    	div.style.width = "5%";
    	div.style.left = "45%";    	    	
    	document.body.appendChild(div);


    	// context //

		var allButtons = [];
	    var AudioContext = window.AudioContext || window.webkitAudioContext;
		var audio = new AudioContext();

		var compressor = audio.createDynamicsCompressor();
		compressor.threshold.value = -50;
		compressor.knee.value = 40;
		compressor.ratio.value = 12;
		compressor.reduction.value = -20;
		compressor.attack.value = 0;
		compressor.release.value = 0.25;
		compressor.connect(audio.destination);

		// buttons //

		for( var i = 0; i<notes.length; ++i ) {
			for( var j = 0; j<4; ++j ) {
				var button = document.createElement("button");
				
				button.oscillator = audio.createOscillator();
				button.oscillator.frequency.value = notes[i] * 4.0;				

				button.gainNode = audio.createGain();				
				button.oscillator.connect( button.gainNode );
				
				if(j==0) {
					button.innerHTML = button.oscillator.type = "sine";
				} else if(j==1) {
					button.innerHTML = button.oscillator.type = "square";
				} else if(j==2) {
					button.innerHTML = button.oscillator.type = "triangle";
				} else if(j==3) {
					button.innerHTML = button.oscillator.type = "sawtooth";					
				}

				button.innerHTML = button.innerHTML.substr(0,3);
				var freqText = "<br>" + button.oscillator.frequency.value;
				button.innerHTML += freqText.substr(0, 10);

				button.style = {};
				button.style.position = "absolute";
				button.style.left = 12 + j * 102;
				button.style.top =  12 + i * 52;
				button.style.width = "100px";
				button.style.height = "50px";

				div.appendChild(button);				

				button.beep = false;
				button.pause=function() {
					if(this.beep) this.gainNode.disconnect(compressor);
					this.beep = false;
					this.style.backgroundColor = "#444";
				}.bind(button);

				button.play=function() {
					if(!this.beep) {
							this.gainNode.connect(compressor);
					 		this.gainNode.gain.value = 0.5;
					}
					this.beep = true;
					this.style.backgroundColor = "#666";
					window.setTimeout(this.pause.bind(this), 1000);
				}.bind(button);
				
				button.onclick=function() {
				    if(!this.beep) 	this.play();
				    else 			this.pause();
				}.bind(button);

				allButtons[i*4 + j] = button;

				//degrade volume
				window.setInterval(
					function() { if(!this.beep) return; this.gainNode.gain.value *= 0.95; }.bind(button),
					10
				);

			}
		}

		for( var i=0; i<allButtons.length; ++i ) {
			allButtons[i].oscillator.start();
		}

		var stop = document.createElement("button");
		stop.style = {};
		stop.style.position = "absolute";
		stop.style.left = 12;
		stop.style.top = 12 + 12 * 52;
		stop.style.width = "100px";
		stop.style.height = "50px";
		stop.innerHTML = "Stop";
		div.appendChild(stop);

		stop.onclick=function () {			
			for( var i=0; i<allButtons.length; ++i ) {
				allButtons[i].pause();
			}
		}

		//metronome
		/*
		var requestFrame =  window.requestAnimationFrame ||
        		            window.mozRequestAnimationFrame ||
                        	window.webkitRequestAnimationFrame ||
                       		window.msRequestAnimationFrame;
        
        var tick = function() {
        	requestFrame(tick);
        	for( var i=0; i<allButtons.length; ++i ) {
				if(allButtons[i].
			}
        }
        requestFrame(tick);
		*/

	</script>
</body>
</html>
